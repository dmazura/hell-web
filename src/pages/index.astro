---
import "../styles/global.css";
import ImageBand from "../components/ImageBand.astro";
import TextBlock from "../components/TextBlock.astro";
import circlesCopyRaw from "../../circles-copy.md?raw";

type CircleCopy = {
  title: string;
  description: string;
};

const circleImageByTitle = {
  Limbo: "/images/01-Limbo.png",
  Lust: "/images/02-Lust.png",
  Gluttony: "/images/03-Gluttony.png",
  Greed: "/images/04-Greed.png",
  Wrath: "/images/05-Wrath.png",
  Heresy: "/images/06-Heresy.png",
  Violence: "/images/07-Violence.png",
  Fraud: "/images/08-Fraud.png",
  Treachery: "/images/09-Treachery.png",
} as const;

const circles = parseCircleCopy(circlesCopyRaw)
  .map((circle) => {
    const src = circleImageByTitle[circle.title as keyof typeof circleImageByTitle];
    return src ? { ...circle, src } : null;
  })
  .filter((circle): circle is CircleCopy & { src: string } => circle !== null);

function parseCircleCopy(markdown: string): CircleCopy[] {
  const blocks = markdown
    .split(/^##\s+/m)
    .map((block) => block.trim())
    .filter(Boolean);

  const circles: CircleCopy[] = [];
  for (const block of blocks) {
    const lines = block
      .split(/\r?\n/)
      .map((line) => line.trim())
      .filter(Boolean);

    const title = lines[0];
    const rest = lines.slice(1).join(" ");
    const dashMatch = rest.match(/—\s*(.*)$/);
    const description = (dashMatch ? dashMatch[1] : rest).trim();

    if (title && description) circles.push({ title, description });
  }
  return circles;
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0E0F12" />
    <title>Hell — Image-first Onepage</title>
  </head>
  <body>
    <main class="page">
      <header class="hero">
        <h1>Hell</h1>
        <p>
          A minimalist, image-first onepage. Stacked full-width images with text
          blocks in between — CSS only.
        </p>
      </header>

      <section class="content-section">
        <TextBlock>
          <h2>Heaven</h2>
          <p>A brief stillness before the descent begins.</p>
        </TextBlock>
        <ImageBand src="/images/00.png" alt="Heaven" />
      </section>

      {
        circles.map(({ title, description, src }) => (
          <section class="content-section">
            <TextBlock>
              <h2>{title}</h2>
              <p>{description}</p>
            </TextBlock>
            <ImageBand src={src} alt={title} />
          </section>
        ))
      }

      <section class="content-section">
        <TextBlock>
          <h2>Lucifer</h2>
          <p>The descent ends where all motion freezes.</p>
        </TextBlock>
        <ImageBand src="/images/10.png" alt="Lucifer" />
      </section>
    </main>
  </body>
</html>
